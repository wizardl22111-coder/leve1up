# ğŸ’³ Ø¯Ù„ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢Ù…Ù† - Next.js 14

## ğŸ“‹ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢Ù…Ù† Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…:
- **Next.js 14** (App Router + TypeScript)
- **Vercel Blob Storage** Ù„Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ÙˆØ§Ù„Ù…Ù„ÙØ§Øª
- **Ziina Payment Gateway** Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹Ø§Øª
- **Token-based Security** Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª

---

## ğŸš€ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø±ÙŠØ¹

### 1ï¸âƒ£ **Environment Variables**

Ø£Ù†Ø´Ø¦ Ù…Ù„Ù `.env.local` ÙÙŠ Ø¬Ø°Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:

```env
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ”‘ Vercel Blob Storage
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„ÙŠÙ‡: https://vercel.com/dashboard â†’ Storage â†’ Blob
BLOB_READ_WRITE_TOKEN=vercel_blob_rw_XXXXXXXXXXXXXXXXXXXXXXXXX

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸŒ Base URL (Ù„Ù„Ø¥Ù†ØªØ§Ø¬)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
NEXT_PUBLIC_BASE_URL=https://leve1up.vercel.app

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“± WhatsApp Support (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø¯Ø¹Ù… (Ø¨Ø¯ÙˆÙ† +)
NEXT_PUBLIC_WHATSAPP_NUMBER=966500000000
```

### 2ï¸âƒ£ **Ø¥Ø¹Ø¯Ø§Ø¯ Ziina Dashboard**

ÙÙŠ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… ZiinaØŒ Ù‚Ù… Ø¨Ø¶Ø¨Ø·:

#### **Webhook URL:**
```
https://leve1up.vercel.app/api/webhook
```

#### **Success Redirect URL:**
```
https://leve1up.vercel.app/order-success?payment_id={PAYMENT_ID}
```

**Ù…Ù„Ø§Ø­Ø¸Ø©:** Ziina Ù‚Ø¯ Ù„Ø§ ØªØ³ØªØ¨Ø¯Ù„ `{PAYMENT_ID}` ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ Ù„ÙƒÙ† Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Webhook Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù€ token.

#### **Webhook Events:**
- âœ… `payment.completed`

---

## ğŸ“ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª

```
project/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ webhook/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts          # Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¯ÙØ¹
â”‚   â”‚   â”œâ”€â”€ record/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts          # Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨
â”‚   â”‚   â””â”€â”€ download/
â”‚   â”‚       â””â”€â”€ [token]/
â”‚   â”‚           â””â”€â”€ route.ts      # ØªØ­Ù…ÙŠÙ„ Ø¢Ù…Ù† Ù„Ù„Ù…Ù„ÙØ§Øª
â”‚   â””â”€â”€ order-success/
â”‚       â””â”€â”€ page.tsx              # ØµÙØ­Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
â”œâ”€â”€ data/
â”‚   â””â”€â”€ products.json             # Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
â””â”€â”€ .env.local                    # Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©
```

---

## ğŸ“¦ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª

### **1. Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ Vercel Blob**

```bash
# ØªØ«Ø¨ÙŠØª Vercel CLI
npm i -g vercel

# ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
vercel login

# Ø±ÙØ¹ Ù…Ù„Ù Ù…Ù†ØªØ¬
vercel blob upload /path/to/product.pdf --token $BLOB_READ_WRITE_TOKEN
```

Ø£Ùˆ Ø¹Ø¨Ø± ÙˆØ§Ø¬Ù‡Ø© Vercel:
```
Dashboard â†’ Storage â†’ Blob â†’ Upload
```

### **2. ØªØ­Ø¯ÙŠØ« products.json**

Ø¨Ø¹Ø¯ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§ØªØŒ Ø¶Ø¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙÙŠ `/data/products.json`:

```json
{
  "product_id": 1,
  "product_name": "Ø¯ÙˆØ±Ø© ØªØ·ÙˆÙŠØ± ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„ÙˆÙŠØ¨",
  "download_url": "https://YOUR_BLOB_URL.../product.pdf",
  "filename": "web-dev-course.pdf",
  "price": 299.00,
  "currency": "AED",
  ...
}
```

---

## ğŸ”„ Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù†Ø¸Ø§Ù…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ï¸âƒ£ Ø¹Ù…ÙŠÙ„ ÙŠØ¯ÙØ¹ Ø¹Ù„Ù‰ Ziina                     â”‚
â”‚    - ÙŠØ®ØªØ§Ø± Ù…Ù†ØªØ¬                            â”‚
â”‚    - ÙŠØ¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹                     â”‚
â”‚    - ÙŠÙÙƒÙ…Ù„ Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2ï¸âƒ£ Ziina ØªØ±Ø³Ù„ Webhook                      â”‚
â”‚    POST /api/webhook                        â”‚
â”‚    {                                        â”‚
â”‚      "data": {                              â”‚
â”‚        "id": "payment_id",                  â”‚
â”‚        "status": "completed",               â”‚
â”‚        "amount": 29900,  // Ø¨Ø§Ù„ÙÙ„Ø³Ø§Øª       â”‚
â”‚        "customer_email": "user@example.com" â”‚
â”‚      }                                      â”‚
â”‚    }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3ï¸âƒ£ Webhook ÙŠÙ†Ø´Ø¦ Token Ø¢Ù…Ù†                  â”‚
â”‚    - Token: tok_<32 hex chars>             â”‚
â”‚    - Expiry: 10 Ø¯Ù‚Ø§Ø¦Ù‚                      â”‚
â”‚    - Order Number: ORD-xxx                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4ï¸âƒ£ Ø­ÙØ¸ Ù…Ø²Ø¯ÙˆØ¬ ÙÙŠ Vercel Blob                â”‚
â”‚    - payments/{payment_id}.json            â”‚
â”‚    - tokens/{token}.json                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5ï¸âƒ£ Ziina ØªÙØ­ÙˆÙ‘Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„                     â”‚
â”‚    â†’ /order-success?payment_id=xxx         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6ï¸âƒ£ ØµÙØ­Ø© ØªØ¬Ù„Ø¨ Ø§Ù„Ø³Ø¬Ù„                         â”‚
â”‚    GET /api/record?payment_id=xxx          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7ï¸âƒ£ Ø¹Ø±Ø¶ ÙØ§ØªÙˆØ±Ø© + Ø²Ø± ØªØ­Ù…ÙŠÙ„                   â”‚
â”‚    - Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„ØµØ­ÙŠØ­                     â”‚
â”‚    - ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬                           â”‚
â”‚    - Ø§Ù„Ù…Ø¨Ù„Øº ÙˆØ§Ù„Ø¹Ù…Ù„Ø©                        â”‚
â”‚    - Ø²Ø±: /api/download/{token}             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8ï¸âƒ£ Ø¹Ù…ÙŠÙ„ ÙŠØ¶ØºØ· "ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬"                â”‚
â”‚    GET /api/download/tok_xxx               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9ï¸âƒ£ Download API ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Token             â”‚
â”‚    âœ“ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Blob                         â”‚
â”‚    âœ“ Ù„Ù… ÙŠÙ†ØªÙ‡Ù (expires_at > now)          â”‚
â”‚    âœ“ ØµØ§Ù„Ø­ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”Ÿ Stream Ø§Ù„Ù…Ù„Ù Ø§Ù„ØµØ­ÙŠØ­ Ø¨Ø£Ù…Ø§Ù†                â”‚
â”‚    - Ø¬Ù„Ø¨ Ù…Ù† Blob URL                      â”‚
â”‚    - Stream Ø¹Ø¨Ø± Ø§Ù„Ø³ÙŠØ±ÙØ±                   â”‚
â”‚    - Headers Ø¢Ù…Ù†Ø©                         â”‚
â”‚    - Mark as used                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ø­Ù…Ø§ÙŠØ©

### **1. Token Security**

```typescript
// Ø¥Ù†Ø´Ø§Ø¡ token Ø¢Ù…Ù† (32 hex chars)
function generateSecureToken(): string {
  const randomPart = randomBytes(16).toString('hex');
  return `tok_${randomPart}`;
}
```

**Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù€ Token:**
- âœ… 32 Ø­Ø±Ù Ø¹Ø´ÙˆØ§Ø¦ÙŠ (cryptographically secure)
- âœ… ØµÙ„Ø§Ø­ÙŠØ© 10 Ø¯Ù‚Ø§Ø¦Ù‚
- âœ… ÙØ±ÙŠØ¯ Ù„ÙƒÙ„ Ø¯ÙØ¹Ø©
- âœ… Single-use support (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)

### **2. Time-Limited Access**

```typescript
// ØµÙ„Ø§Ø­ÙŠØ© 10 Ø¯Ù‚Ø§Ø¦Ù‚
function getExpiryTimestamp(minutes: number = 10): string {
  return new Date(Date.now() + minutes * 60 * 1000).toISOString();
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
function isTokenExpired(expiresAt: string): boolean {
  return new Date(expiresAt) < new Date();
}
```

### **3. Secure Download**

- âœ… **Ù„Ø§ ÙŠØªÙ… ÙƒØ´Ù Ø±Ø§Ø¨Ø· Blob Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…**
- âœ… Ø§Ù„Ù…Ù„Ù ÙŠÙÙ†Ù‚Ù„ Ø¹Ø¨Ø± Ø§Ù„Ø³ÙŠØ±ÙØ± (Streaming)
- âœ… Secure HTTP Headers
- âœ… No Caching
- âœ… IP & User-Agent Tracking

### **4. Single-Use Tokens (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)**

Ù„ØªÙØ¹ÙŠÙ„ single-useØŒ Ø£Ø²Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ØªØ§Ù„ÙŠ ÙÙŠ `/app/api/download/[token]/route.ts`:

```typescript
if (record.used) {
  return NextResponse.json({
    error: "Token already used",
    message: "ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ø³Ø¨Ù‚Ø§Ù‹",
    code: "TOKEN_ALREADY_USED"
  }, { status: 410 });
}
```

---

## ğŸ¯ Ø¯Ø¹Ù… Ø¹Ø¯Ø© Ù…Ù†ØªØ¬Ø§Øª

### **ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Product MatchingØŸ**

ÙÙŠ `/app/api/webhook/route.ts`:

```typescript
function matchProduct(productId?: number, message?: string) {
  // 1. Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø¨Ù€ product_id
  if (productId) {
    const product = products.find(p => 
      p.product_id === productId && p.active
    );
    if (product) return product;
  }
  
  // 2. Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø¨Ù€ message
  if (message) {
    const product = products.find(p => {
      const nameLower = p.product_name.toLowerCase();
      return nameLower.includes(message.toLowerCase());
    });
    if (product) return product;
  }
  
  // 3. Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
  return products[0];
}
```

### **Ø·Ø±Ù‚ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù†ØªØ¬:**

#### **1. Ø¹Ø¨Ø± metadata ÙÙŠ Ziina:**
```javascript
// ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹
metadata: {
  product_id: 1
}
```

#### **2. Ø¹Ø¨Ø± message:**
```javascript
// Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠÙƒØªØ¨ ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
message: "Ø¯ÙˆØ±Ø© ØªØ·ÙˆÙŠØ± Ø§Ù„ÙˆÙŠØ¨"
```

#### **3. Ø§ÙØªØ±Ø§Ø¶ÙŠ:**
Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ¯ØŒ ÙŠÙØ®ØªØ§Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù†Ø´Ø·.

---

## ğŸ§ª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±

### **1. Ø§Ø®ØªØ¨Ø§Ø± Webhook ÙŠØ¯ÙˆÙŠØ§Ù‹**

```bash
curl -X POST https://leve1up.vercel.app/api/webhook \
  -H "Content-Type: application/json" \
  -d '{
    "data": {
      "id": "test-payment-12345",
      "status": "completed",
      "amount": 29900,
      "currency_code": "AED",
      "customer_email": "test@example.com",
      "customer_name": "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯",
      "message": "Ø¯ÙˆØ±Ø© ØªØ·ÙˆÙŠØ± Ø§Ù„ÙˆÙŠØ¨",
      "metadata": {
        "product_id": 1
      }
    }
  }'
```

**Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:**
```json
{
  "success": true,
  "payment_id": "test-payment-12345",
  "access_token": "tok_a3f8c9d2...",
  "redirect_url": "https://leve1up.vercel.app/order-success?payment_id=xxx"
}
```

### **2. Ø§Ø®ØªØ¨Ø§Ø± Record API**

```bash
curl "https://leve1up.vercel.app/api/record?payment_id=test-payment-12345"
```

### **3. Ø§Ø®ØªØ¨Ø§Ø± Download API**

```bash
curl "https://leve1up.vercel.app/api/download/tok_xxx" -o product.pdf
```

### **4. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙØ§ØªÙˆØ±Ø©**

Ø§ÙØªØ­ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­:
```
https://leve1up.vercel.app/order-success?payment_id=test-payment-12345
```

---

## ğŸ“Š Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© ÙˆØ§Ù„ØªØªØ¨Ø¹

### **Vercel Logs**

```bash
# Ø¹Ø±Ø¶ logs Ø­ÙŠØ©
vercel logs --follow

# ØªØµÙÙŠØ© Ø­Ø³Ø¨ function
vercel logs --filter=api/webhook
vercel logs --filter=api/download
```

### **Console Logging**

ÙƒÙ„ endpoint ÙŠØ·Ø¨Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªÙØµÙŠÙ„ÙŠØ©:

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”” WEBHOOK RECEIVED
â° Timestamp: 2024-11-05T07:25:00.000Z
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š PAYMENT DETAILS:
  ğŸ’³ Payment ID: 24d7813b-2af7-4c89-b9be-040ec8e626a6
  ğŸ“Š Status: completed
  ğŸ’° Amount: 29900 fils = 299.00 AED
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“¦ PRODUCT MATCHED:
  ğŸ†” Product ID: 1
  ğŸ“ Name: Ø¯ÙˆØ±Ø© ØªØ·ÙˆÙŠØ± ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„ÙˆÙŠØ¨
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… PAYMENT SAVED SUCCESSFULLY!
ğŸ’³ Payment ID: 24d7813b-2af7-4c89-b9be-040ec8e626a6
ğŸ« Token: tok_a3f8c9d2e7b4f1a6...
â±ï¸ Processing time: 245ms
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ› Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡

### **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: Webhook Ù„Ø§ ÙŠØµÙ„**

**Ø§Ù„Ø­Ù„ÙˆÙ„:**
1. ØªØ­Ù‚Ù‚ Ù…Ù† URL ÙÙŠ Ù„ÙˆØ­Ø© Ziina
2. ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† endpoint Ù…ØªØ§Ø­: `GET /api/webhook`
3. Ø±Ø§Ø¬Ø¹ Vercel logs: `vercel logs --filter=api/webhook`

### **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: Ø§Ù„Ø³Ø¬Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯**

**Ø§Ù„Ø­Ù„ÙˆÙ„:**
1. Ø§Ù†ØªØ¸Ø± 30-60 Ø«Ø§Ù†ÙŠØ© (ØªØ£Ø®Ø± Webhook Ø·Ø¨ÙŠØ¹ÙŠ)
2. ØªØ­Ù‚Ù‚ Ù…Ù† Vercel Blob Dashboard
3. ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© payment_id

### **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: Token Ù…Ù†ØªÙ‡ÙŠ**

**Ø§Ù„Ø­Ù„ÙˆÙ„:**
1. Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª ØµØ§Ù„Ø­Ø© Ù„Ù€ 10 Ø¯Ù‚Ø§Ø¦Ù‚ ÙÙ‚Ø·
2. ÙŠÙ…ÙƒÙ† Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¯Ø© ÙÙŠ `getExpiryTimestamp(minutes)`
3. Ø¹Ø±Ø¶ Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø¯Ø¹Ù…

### **Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: Ø§Ù„Ù…Ù„Ù Ù„Ø§ ÙŠÙØ­Ù…Ù‘Ù„**

**Ø§Ù„Ø­Ù„ÙˆÙ„:**
1. ØªØ­Ù‚Ù‚ Ù…Ù† `download_url` ÙÙŠ `products.json`
2. ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù„Ù ÙÙŠ Vercel Blob
3. Ø±Ø§Ø¬Ø¹ logs: `vercel logs --filter=api/download`

---

## ğŸš€ Ø§Ù„Ù†Ø´Ø± Ø¹Ù„Ù‰ Vercel

### **1. Push Ø§Ù„ÙƒÙˆØ¯**

```bash
git add .
git commit -m "Complete payment system"
git push origin main
```

### **2. Ø±Ø¨Ø· Ù…Ø¹ Vercel**

```bash
vercel login
vercel link
```

### **3. Ø¥Ø¶Ø§ÙØ© Environment Variables**

ÙÙŠ Vercel Dashboard:
```
Settings â†’ Environment Variables
```

Ø£Ø¶Ù:
- `BLOB_READ_WRITE_TOKEN`
- `NEXT_PUBLIC_BASE_URL`
- `NEXT_PUBLIC_WHATSAPP_NUMBER`

### **4. Deploy**

```bash
vercel --prod
```

---

## ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©

### **1. Ø±ÙˆØ§Ø¨Ø· Blob**

Ø§Ø³ØªØ¨Ø¯Ù„ `YOUR_BLOB_URL` ÙÙŠ `products.json` Ø¨Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† Vercel Blob.

### **2. Product Matching**

Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ù…Ø·Ø§Ø¨Ù‚Ø©:
- Ø§Ø³ØªØ®Ø¯Ù… `metadata.product_id` ÙÙŠ Ziina
- Ø£Ùˆ ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø¯Ù‚Ø© ÙÙŠ `message`

### **3. Security**

- âœ… Ù„Ø§ ØªÙƒØ´Ù `BLOB_READ_WRITE_TOKEN` Ø¹Ù„Ù†Ø§Ù‹
- âœ… Ø§Ø³ØªØ®Ø¯Ù… HTTPS ÙÙ‚Ø·
- âœ… Ø±Ø§Ø¬Ø¹ logs Ø¨Ø§Ù†ØªØ¸Ø§Ù… Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ø®ØªØ±Ø§Ù‚

---

## ğŸ“ Ø§Ù„Ø¯Ø¹Ù…

**Ù„Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©:**
- ğŸ“§ Email: support@leve1up.com
- ğŸ’¬ WhatsApp: +966500000000
- ğŸŒ Website: https://leve1up.vercel.app

---

## âœ… Checklist Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯

- [ ] Ø¥Ù†Ø´Ø§Ø¡ `.env.local` Ù…Ø¹ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
- [ ] Ø±ÙØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¥Ù„Ù‰ Vercel Blob
- [ ] ØªØ­Ø¯ÙŠØ« `products.json` Ø¨Ø±ÙˆØ§Ø¨Ø· Blob Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
- [ ] Ø¥Ø¹Ø¯Ø§Ø¯ Webhook URL ÙÙŠ Ziina
- [ ] Ø¥Ø¹Ø¯Ø§Ø¯ Success URL ÙÙŠ Ziina
- [ ] Ø§Ø®ØªØ¨Ø§Ø± Webhook ÙŠØ¯ÙˆÙŠØ§Ù‹
- [ ] Ø§Ø®ØªØ¨Ø§Ø± ØµÙØ­Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
- [ ] Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
- [ ] Ù†Ø´Ø± Ø¹Ù„Ù‰ Vercel
- [ ] Ø¥Ø¶Ø§ÙØ© Environment Variables ÙÙŠ Vercel

---

**Made with â¤ï¸ in Saudi Arabia ğŸ‡¸ğŸ‡¦**

